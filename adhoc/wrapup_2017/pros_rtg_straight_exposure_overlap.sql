select
                case when b.user_id is not null then 1 else 0 end as RTG_flag,
                case when c.user_id is not null then 1 else 0 end as Adara_flag,
                case when d.user_id is not null then 1 else 0 end as Amobee_flag,
                case when e.user_id is not null then 1 else 0 end as Quantcast_flag,
                case when f.user_id is not null then 1 else 0 end as SojernPRS_flag,
                case when g.user_id is not null then 1 else 0 end as DBMPRS_flag,
                sum(1) as user_cnt,
                coalesce(sum(site_RTG_cnt),0) as RTG_imps,
                coalesce(sum(site_Adara_cnt),0) as Adara_imps,
                coalesce(sum(site_Amobee_cnt),0) as Amobee_imps,
                coalesce(sum(site_Quantcast_cnt),0) as Quantcast_imps,
                coalesce(sum(site_SojernPRS_cnt),0) as SojernPRS_imps,
                coalesce(sum(site_DBMPRS_cnt),0) as DBMPRS_imps
from
                (select
                                distinct user_id
                from
                                diap01.mec_us_united_20056.dfa2_impression
                where
                                user_id <> '0'
                                and advertiser_id <> '0'
                                and cast(to_timestamp(event_time / 1000000) as date) between '2017-08-15' and '2017-12-31'
                                and campaign_id = 10742878
                                and placement_id in ('143540511', '143539476',    '143537264',    '143539857',    '143539858',    '143540044',    '143539256',    '143540515',    '143540516',    '143540719',
                                 '143539481',    '143540335',    '143540407',    '143540720',    '143539483',    '143539484',    '143539938',    '143540336',    '143540408',    '143540337',    '143539637',
                                 '143539639',    '143540340',    '143539640',    '143540411',    '143540412',    '143540519',    '143539341',    '143540520',    '143539643',    '143540521',    '143539490',
                                 '143540522',    '143540344',    '143540417',    '143539940',    '143539491',    '143539492',    '143539493',    '143540346',    '143540348',    '143539260',    '143540524',
                                 '143540350',    '143540419',    '143540420',    '143540526',    '143539647',    '143540049',    '143537268',    '143539494',    '143540722',    '143539943',    '143539944',
                                 '143539495',    '143539945',    '143539264',    '143540355',    '143539946',    '143538286',    '143539861',    '143538590',    '143540051',    '143537269',    '143537270',
                                  '143538591',    '143538592',    '143540421',    '143537271',    '143540724',    '143537272',    '143540356',    '143540357',    '143539863',    '143540052',    '143539345',
                                  '143540725',    '143538593',    '143540726',    '143540727',    '143538288',    '143540728',    '143537273',    '143539346',    '143540053',    '143539347',    '143539348',
                                  '143538594',    '143540054',    '143540730',    '143538290',    '143540731',    '143539867',    '143538595',    '143539349',    '143540732',    '143537276',    '143537277',
                                  '143540738',    '143537283',    '143537284',    '143540739',    '143541400',    '143540741',    '143539361',    '143537285',    '143540061',    '143539364',    '143539365',
                                  '143541403',    '143538291',    '202073198',    '202085114',    '202086305',    '202089276',    '202084835',    '202081085',    '202089939',    '202092453',    '202080560',
                                  '202092450',    '202088745',    '202080851',    '202082849',    '202083077',    '202084159',    '202079560',    '202080857',    '202080563',    '202082846',    '202084168',
                                  '202083083',    '202083089',    '202075589',    '202089249',    '202082974',    '202088472',    '202088475',    '202088730',    '202080536',    '202090632',    '202083056',
                                  '202079881',    '202073344',    '202088727',    '202084823',    '202080545',    '202080839',    '202089930',    '202086685',    '202088742',    '202092447',    '202084832',
                                  '202086688',    '202082950',    '202091661',    '202089402',    '202093350',    '202093353',    '202091658',    '202087481',    '202078423',    '202089420',    '202081076',
                                  '202089411',    '202086677',    '202091664',    '202086680',    '202078375',    '202078378',    '202073338',    '202079872',    '202080533',    '202088721',    '202084811',
                                  '202073180',    '202073341',    '202073183',    '202079878',    '202075586',    '202078381',    '202073238',    '202079875',    '202078384',    '202088188',    '202088191',
                                  '202083248',    '202082969',    '202088179',    '202082966',    '202083242',    '202092228',    '202088203',    '202086644',    '202092237',    '202093344',    '202092234',
                                  '202083254',    '202092240',    '202088206',    '202086650',    '202092252',    '202083269',    '202091655',    '202089399',    '202092246',    '202088215',    '202091652',
                                  '202092186',    '202083215',    '202083218',    '202091613',    '202086608',    '202083206',    '202091607',    '202089345',    '202086617',    '202088152',    '202088155',
                                  '202092189',    '202082945',    '202091619',    '202083221',    '202091622',    '202089363',    '202086623',    '202089366',    '202088167',    '202086620',    '202088161',
                                  '202092192',    '202091628',    '202086629',    '202092216',    '202089375',    '202091634',    '202092204',    '202082957',    '202083233',    '202092210',    '202086578',
                                  '202091556',    '202091562',    '202083161',    '202088793',    '202088796',    '202083158',    '202091571',    '202082918',    '202082921',    '202079590',    '202073362',
                                  '202073356',    '202089450',    '202079581',    '202082888',    '202089987',    '202086302',    '202084889',    '202086694',    '202089405',    '202083275',    '202088221',
                                  '202088781',    '202086727',    '206692529',    '206753946',    '206753517',    '206754066',    '206689634',    '206692739',    '206728678',    '206728648',    '206753637',
                                  '206692310',    '206692736',    '206692532',    '206691875',    '206692301',    '206692730',    '206691872',    '206692520',    '206692733',    '206754057',    '206692718',
                                  '206692487',    '206692721',    '206692499',    '206729014',    '206692502',    '206754060',    '206692703',    '206692274',    '206754045',    '206692280',    '206692481',
                                  '206729053',    '206692673',    '206728684',    '206728687',    '206728693',    '206692457',    '206692442',    '206728948',    '206692661',    '206753988',    '206754000',
                                  '206728936',    '206692427',    '206692424',    '206728669',    '206728666',    '206728945',    '206692433',    '206728927',    '206689640',    '206728930',    '206689646',
                                  '206692211',    '206692208',    '206692418',    '206692409',    '206753952',    '206692412',    '206689631',    '206692202',    '206753961',    '206728660',    '206692196',
                                  '206692193',    '206691782',    '206689622',    '206728918',    '206691791',    '206691785',    '206753934',    '206689616',    '206692184',    '206689619',    '206692187',
                                  '206692190',    '206753940',    '206753925',    '206728642',    '206692181',    '206728906',    '206753928',    '206692403',    '206691776',    '206753913',    '206691773',
                                  '206728903',    '206728612',    '206728618',    '206692142',    '206728870',    '206728975',    '206692166',    '206692361',    '206753880',    '206728594',    '206729026',
                                  '206692307',    '206729092',    '206754063',    '206729074',    '206692505',    '206729077',    '206692712',    '206728726',    '206692469',    '206754033',    '206729032',
                                  '206754039',    '206692679',    '206728987',    '206692682',    '206728720',    '206728723',    '206692685',    '206692670',    '206728681',    '206691827',    '206753997',
                                  '206728966',    '206753982',    '206753970',    '206753931',    '206691770',    '206753922',    '206728621',    '206692373',    '206692169',    '206692385',    '206689595',
                                  '206691758',    '206692151',    '206689598',    '206691764',    '206692352',    '206753892',    '206692355',    '206691755',    '206689592',    '206692136',    '206753883',
                                  '206753886',    '206752923',    '206689577',    '206753511',    '206753877',    '206753514',    '206752917',    '206692472',    '206691842',    '206728636',    '206728639',
                                  '206692160',    '206728900',    '206689589',    '206692133',    '206692127',    '206692289',    '206729005',    '206692463',    '206689580',    '206692148',    '206753916',
                                  '203511879',    '203509539',    '203508153',    '203509554',    '203505786',    '203509557',    '203495683',    '203505789',    '203492720',    '203549403',    '203509542',
                                  '203508138',    '203510646',    '203505774',    '203495668',    '203495671',    '203493518',    '203511276',    '203510625',    '203511534',    '203494199',    '203549277',
                                  '203508132',    '203494742',    '203493515',    '203493509',    '203511543',    '203572512',    '203572827',    '203553725',    '203552765',    '203566804',     '203553719',
                                  '203572815',    '203572821',    '203565841',    '203566792',    '203566771',    '203570277',    '203570286',    '203553686',    '203572482',    '143539258',     '143539479',
                                  '143539480',    '143540333',    '203572803',    '203566780' ))  a

Left Outer Join
                (select
                                user_id,
                                sum(1) as site_RTG_cnt
                from
                               diap01.mec_us_united_20056.dfa2_impression
                where
                                campaign_id = 10742878
                                and user_id <> '0'
                                and advertiser_id <> '0'
                                and cast(to_timestamp(event_time / 1000000) as date) between '2017-08-15' and '2017-12-31'
                                and placement_id in ('143540511', '143539476',    '143537264',    '143539857',    '143539858',    '143540044',    '143539256',    '143540515',    '143540516',    '143540719',    '143539258',    '143539479',    '143539480',    '143540333',
                                 '143539481',    '143540335',    '143540407',    '143540720',    '143539483',    '143539484',    '143539938',    '143540336',    '143540408',    '143540337',    '143539637',
                                 '143539639',    '143540340',    '143539640',    '143540411',    '143540412',    '143540519',    '143539341',    '143540520',    '143539643',    '143540521',    '143539490',
                                 '143540522',    '143540344',    '143540417',    '143539940',    '143539491',    '143539492',    '143539493',    '143540346',    '143540348',    '143539260',    '143540524',
                                 '143540350',    '143540419',    '143540420',    '143540526',    '143539647',    '143540049',    '143537268',    '143539494',    '143540722',    '143539943',    '143539944',
                                 '143539495',    '143539945',    '143539264',    '143540355',    '143539946',    '143538286',    '143539861',    '143538590',    '143540051',    '143537269',    '143537270',
                                  '143538591',    '143538592',    '143540421',    '143537271',    '143540724',    '143537272',    '143540356',    '143540357',    '143539863',    '143540052',    '143539345',
                                  '143540725',    '143538593',    '143540726',    '143540727',    '143538288',    '143540728',    '143537273',    '143539346',    '143540053',    '143539347',    '143539348',
                                  '143538594',    '143540054',    '143540730',    '143538290',    '143540731',    '143539867',    '143538595',    '143539349',    '143540732',    '143537276',    '143537277',
                                  '143540738',    '143537283',    '143537284',    '143540739',    '143541400',    '143540741',    '143539361',    '143537285',    '143540061',    '143539364',    '143539365',
                                  '143541403',    '143538291',    '202073198',    '202085114',    '202086305',    '202089276',    '202084835',    '202081085',    '202089939',    '202092453',    '202080560',
                                  '202092450',    '202088745',    '202080851',    '202082849',    '202083077',    '202084159',    '202079560',    '202080857',    '202080563',    '202082846',    '202084168',
                                  '202083083',    '202083089',    '202075589',    '202089249',    '202082974',    '202088472',    '202088475',    '202088730',    '202080536',    '202090632',    '202083056',
                                  '202079881',    '202073344',    '202088727',    '202084823',    '202080545',    '202080839',    '202089930',    '202086685',    '202088742',    '202092447',    '202084832',
                                  '202086688',    '202082950',    '202091661',    '202089402',    '202093350',    '202093353',    '202091658',    '202087481',    '202078423',    '202089420',    '202081076',
                                  '202089411',    '202086677',    '202091664',    '202086680',    '202078375',    '202078378',    '202073338',    '202079872',    '202080533',    '202088721',    '202084811',
                                  '202073180',    '202073341',    '202073183',    '202079878',    '202075586',    '202078381',    '202073238',    '202079875',    '202078384',    '202088188',    '202088191',
                                  '202083248',    '202082969',    '202088179',    '202082966',    '202083242',    '202092228',    '202088203',    '202086644',    '202092237',    '202093344',    '202092234',
                                  '202083254',    '202092240',    '202088206',    '202086650',    '202092252',    '202083269',    '202091655',    '202089399',    '202092246',    '202088215',    '202091652',
                                  '202092186',    '202083215',    '202083218',    '202091613',    '202086608',    '202083206',    '202091607',    '202089345',    '202086617',    '202088152',    '202088155',
                                  '202092189',    '202082945',    '202091619',    '202083221',    '202091622',    '202089363',    '202086623',    '202089366',    '202088167',    '202086620',    '202088161',
                                  '202092192',    '202091628',    '202086629',    '202092216',    '202089375',    '202091634',    '202092204',    '202082957',    '202083233',    '202092210',    '202086578',
                                  '202091556',    '202091562',    '202083161',    '202088793',    '202088796',    '202083158',    '202091571',    '202082918',    '202082921',    '202079590',    '202073362',
                                  '202073356',    '202089450',    '202079581',    '202082888',    '202089987',    '202086302',    '202084889',    '202086694',    '202089405',    '202083275',    '202088221',
                                  '202088781',    '202086727',    '206692529',    '206753946',    '206753517',    '206754066',    '206689634',    '206692739',    '206728678',    '206728648',    '206753637',
                                  '206692310',    '206692736',    '206692532',    '206691875',    '206692301',    '206692730',    '206691872',    '206692520',    '206692733',    '206754057',    '206692718',
                                  '206692487',    '206692721',    '206692499',    '206729014',    '206692502',    '206754060',    '206692703',    '206692274',    '206754045',    '206692280',    '206692481',
                                  '206729053',    '206692673',    '206728684',    '206728687',    '206728693',    '206692457',    '206692442',    '206728948',    '206692661',    '206753988',    '206754000',
                                  '206728936',    '206692427',    '206692424',    '206728669',    '206728666',    '206728945',    '206692433',    '206728927',    '206689640',    '206728930',    '206689646',
                                  '206692211',    '206692208',    '206692418',    '206692409',    '206753952',    '206692412',    '206689631',    '206692202',    '206753961',    '206728660',    '206692196',
                                  '206692193',    '206691782',    '206689622',    '206728918',    '206691791',    '206691785',    '206753934',    '206689616',    '206692184',    '206689619',    '206692187',
                                  '206692190',    '206753940',    '206753925',    '206728642',    '206692181',    '206728906',    '206753928',    '206692403',    '206691776',    '206753913',    '206691773',
                                  '206728903',    '206728612',    '206728618',    '206692142',    '206728870',    '206728975',    '206692166',    '206692361',    '206753880',    '206728594',    '206729026',
                                  '206692307',    '206729092',    '206754063',    '206729074',    '206692505',    '206729077',    '206692712',    '206728726',    '206692469',    '206754033',    '206729032',
                                  '206754039',    '206692679',    '206728987',    '206692682',    '206728720',    '206728723',    '206692685',    '206692670',    '206728681',    '206691827',    '206753997',
                                  '206728966',    '206753982',    '206753970',    '206753931',    '206691770',    '206753922',    '206728621',    '206692373',    '206692169',    '206692385',    '206689595',
                                  '206691758',    '206692151',    '206689598',    '206691764',    '206692352',    '206753892',    '206692355',    '206691755',    '206689592',    '206692136',    '206753883',
                                  '206753886',    '206752923',    '206689577',    '206753511',    '206753877',    '206753514',    '206752917',    '206692472',    '206691842',    '206728636',    '206728639',
                                  '206692160',    '206728900',    '206689589',    '206692133',    '206692127',    '206692289',    '206729005',    '206692463',    '206689580',    '206692148',    '206753916')
                group by
                                1) b On a.user_id = b.user_id
Left Outer Join
                (select
                                user_id,
                                sum(1) as site_Adara_cnt
                from
                               diap01.mec_us_united_20056.dfa2_impression
                where
                                campaign_id = 10742878
                                and user_id <> '0'
                                and advertiser_id <> '0'
                                and cast(to_timestamp(event_time / 1000000) as date) between '2017-08-15' and '2017-12-31'
                                and placement_id in ('203511879','203509539','203508153','203509554','203505786','203509557','203495683','203505789','203492720')

                group by
                                1) c On a.user_id = c.user_id

Left Outer Join
                (select
                                user_id,
                                sum(1) as site_Amobee_cnt
                from
                               diap01.mec_us_united_20056.dfa2_impression
                where
                                campaign_id = 10742878
                                and user_id <> '0'
                                and advertiser_id <> '0'
                                and cast(to_timestamp(event_time / 1000000) as date) between '2017-08-15' and '2017-12-31'
                                and placement_id in ('203549403','203509542','203508138','203510646','203505774','203495668','203495671','203493518','203511276')
                group by
                                1) d On a.user_id=d.user_id

Left Outer Join
                (select
                                user_id,
                                sum(1) as site_Quantcast_cnt
                from
                               diap01.mec_us_united_20056.dfa2_impression
                where
                                campaign_id = 10742878
                                and user_id <> '0'
                                and advertiser_id <> '0'
                                and cast(to_timestamp(event_time / 1000000) as date) between '2017-08-15' and '2017-12-31'
                                and placement_id in ('203510625','203511534','203494199','203549277','203508132','203494742','203493515','203493509','203511543')
                group by

                            1) e On a.user_id = e.user_id

Left Outer Join
                (select
                                user_id,
                                sum(1) as site_SojernPRS_cnt
                from
                               diap01.mec_us_united_20056.dfa2_impression
                where
                                campaign_id = 10742878
                                and user_id <> '0'
                                and advertiser_id <> '0'
                                and cast(to_timestamp(event_time / 1000000) as date) between '2017-08-15' and '2017-12-31'
                                and placement_id in ('203572512', '203572827','203553725','203552765','203566804','203553719','203572815','203572821','203565841')
                group by
                                1) f On a.user_id = f.user_id

Left Outer Join
                (select
                                user_id,
                                sum(1) as site_DBMPRS_cnt
                from
                               diap01.mec_us_united_20056.dfa2_impression
                where
                                campaign_id = 10742878
                                and user_id <> '0'
                                and advertiser_id <> '0'
                                and cast(to_timestamp(event_time / 1000000) as date) between '2017-08-15' and '2017-12-31'
                                and placement_id in ('203566792','203566771','203570277','203570286','203553686','203572482','203572803','203566780')

                group by
                                1) g On a.user_id = g.user_id




group by
                1,2,3,4,5,6
order by
                1,2,3,4,5,6;
